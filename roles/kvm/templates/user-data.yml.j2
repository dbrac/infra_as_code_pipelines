#cloud-config
########################################
## Sets user name, password, and ssh key
########################################
hostname: {{ hostname }}
users:
  - name: {{ ubuntu_user }}
    lock_passwd: true 
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    groups: sudo
    ssh_authorized_keys: {{ [ssh_public_key] if ssh_public_key is defined else [] }}

ssh_pwauth: false    
disable_root: true